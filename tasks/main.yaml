---
- name: Disable swap
  command: swapoff -a

- name: Disable SWAP in fstab
  replace:
    path: /etc/fstab
    regexp: '^([^#].*?\sswap\s+sw.*)$'
    replace: '# \1'

- name: Include "{{kube_install_method}}" tasks
  include_tasks: "{{kube_install_method}}.yaml"

- name: force handlers
  meta: flush_handlers

- name: Add KUBELET_EXTRA_ARGS
  lineinfile:
    dest: "{{item}}/kubelet"
    line: 'KUBELET_EXTRA_ARGS=--cgroup-driver=systemd {{kubelet_extra_args}}'
    regexp: 'KUBELET_EXTRA_ARGS='
    create: yes
  notify: restart kubelet
  with_first_found:
    - files:
       - /etc/sysconfig/
       - /etc/default/

- name: Include "{{kube_type_of_node}}" tasks
  include_tasks: "{{kube_type_of_node}}.yaml"