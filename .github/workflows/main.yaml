---
name: CI

on:
  push:
    branches: [master]

jobs:
  test:

    runs-on: ubuntu-18.04

    steps:
      - name: checkout
        uses: actions/checkout@v2

      - name: install requisites
        run: apt update && apt install -y python3 python3-pip

      - name: install requisites
        run: pip3 install ansible

      - name: Create ansible.cfg with correct roles_path
        run: printf '[defaults]\nroles_path=../' > ansible.cfg
  
      - name: Install dependency
        run: ansible-galaxy install grycap.ntp
  
      - name: Basic role syntax check
        run: ansible-playbook tests/test.yml -i tests/inventory --syntax-check

      - name: Basic role check
        run: ansible-playbook tests/test.yml -i tests/inventory