---
apiVersion: gateway.nginx.org/v1alpha1
kind: SnippetsFilter
metadata:
  namespace: kubeapps
  name: proxy-timeouts
spec:
  snippets:
    - context: http.server.location
      value: |
        proxy_read_timeout 600;
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: kubeapps
  namespace: kubeapps
spec:
  parentRefs:
{% if kube_ingress_type == "nginx" %}
  - name: nginx-gateway
    namespace: nginx-gateway
{% endif %}
{% if kube_ingress_type == "traefik" %}
  - name: traefik-gateway
    namespace: traefik
{% endif %}
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: "/kubeapps"
    backendRefs:
    - name: kubeapps
      port: 80
    filters:
      - type: ExtensionRef
        extensionRef:
          group: gateway.nginx.org
          kind: SnippetsFilter
          name: proxy-timeouts
